{% load static %}
<section id="portfolio" class="portfolio section">
    <!-- Section Title -->
    <div class="container section-title" data-aos="fade-up">
        <h2>Portfolio</h2>
        <p>
            Welcome to my portfolio. I specialize in full-stack programming, delivering high-quality, results-driven
            solutions. My work reflects a commitment to excellence and attention to detail. Explore my projects to see
            how my skills can contribute to your team.
        </p>
    </div>

    <div class="container">
        <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">
            <!-- Search and Filter Controls -->
            <div class="portfolio-controls" data-aos="fade-up" data-aos-delay="100">
                <div class="search-bar">
                    <input
                        type="text"
                        id="name-search"
                        class="form-control"
                        placeholder="Search projects..."
                        aria-label="Search projects"
                    />
                    <i class="bi bi-search search-icon"></i>
                </div>

                <ul class="portfolio-filters isotope-filters">
                    <li data-filter="*" class="filter-active">All</li>
                    {% for tag in tags %}
                    <li data-tag="{{ tag.name|lower }}" data-filter=".filter-{{ tag.name|slugify }}">{{ tag.name }}</li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Portfolio Grid -->
            <div class="row gy-4 isotope-container" data-aos="fade-up" data-aos-delay="200">
                {% for project in projects %}
                <div
                    class="col-lg-4 col-md-6 portfolio-item isotope-item 
                            {% for tag in project.tags.all %}filter-{{ tag.name|slugify }} {% endfor %}"
                    data-name="{{ project.title|lower }}"
                    data-tags="{{ project.tags.all|join:', '|lower }}"
                >
                    <div class="portfolio-card">
                        {% if project.random_image %}
                        <img
                            src="{{ project.random_image.image.url }}"
                            class="img-fluid"
                            alt="{{ project.title }}"
                            loading="lazy"
                        />
                        {% else %}
                        <img
                            src="{% static 'img/image-placeholder.png' %}"
                            class="img-fluid"
                            alt="Project placeholder image"
                            loading="lazy"
                        />
                        {% endif %}

                        <div class="portfolio-info">
                            <h4>{{ project.title }}</h4>
                            <div class="project-tags">
                                {% for tag in project.tags.all %}
                                <span class="tag">{{ tag.name }}</span>
                                {% endfor %}
                            </div>
                            <p class="project-description">{{ project.description|truncatewords:20 }}</p>

                            <div class="portfolio-links">
                                {% if project.random_image %}
                                <a
                                    href="{{ project.random_image.image.url }}"
                                    title="{{ project.title }}"
                                    data-gallery="portfolio-gallery"
                                    class="glightbox preview-link"
                                >
                                    <i class="bi bi-zoom-in"></i>
                                </a>
                                {% endif %}
                                <a
                                    href="{% url 'project' project.id %}"
                                    title="View Project Details"
                                    class="details-link"
                                >
                                    <i class="bi bi-link-45deg"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<style>
    .portfolio-controls {
        margin-bottom: 2rem;
    }

    .search-bar {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .search-bar input {
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border-radius: 0.5rem;
        border: 1px solid #e2e8f0;
        width: 100%;
        max-width: 400px;
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #64748b;
    }

    .portfolio-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .portfolio-filters li {
        padding: 0.5rem 1rem;
        border-radius: 0.25rem;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .portfolio-filters li:hover,
    .portfolio-filters li.filter-active {
        background-color: #2563eb;
        color: white;
    }

    .portfolio-card {
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        transition: transform 0.3s ease;
    }

    .portfolio-card:hover {
        transform: translateY(-4px);
    }

    .project-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 0.5rem 0;
    }

    .tag {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        background-color: #e2e8f0;
        font-size: 0.875rem;
    }

    .portfolio-links {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .portfolio-links a {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8fafc;
        color: #0f172a;
        transition: all 0.3s ease;
    }

    .portfolio-links a:hover {
        background-color: #2563eb;
        color: white;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("name-search");
        const portfolioItems = document.querySelectorAll(".portfolio-item");

        searchInput.addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();

            portfolioItems.forEach((item) => {
                const projectName = item.dataset.name;
                const projectTags = item.dataset.tags;
                const matchesSearch = projectName.includes(searchTerm) || projectTags.includes(searchTerm);

                item.style.display = matchesSearch ? "block" : "none";
            });
        });
    });
</script>
